"use strict";if(window.RBTokens!==void 0)throw new Error("RBTokens is already defined");else window.RBTokens={};RBTokens.constant={prodNA:"rbdigital.com",stageNA:"rbdigitalstage.com",uatNA:"rbdigitaluat.com",qaNA:"rbdigitalqa.com",prodEU:"rbdigitalglobal.com",stageEU:"rbdigitalglobalstage.com",uatEU:"rbdigitalglobaluat.com",qaEU:"rbdigitalglobalqa.com",authurl:"auth",apiurl:"api"},RBTokens.settings={},RBTokens.settings.env="prod",RBTokens.settings.template={title:{text:"Log into Your Account",fontSize:"25px",color:"#802754",fontWeight:"700",marginBottom:"25px"},labels:{indentifier:"LIBRARYCARD",secret:"PIN",fontSize:"14px",color:"#48494A",fontWeight:"600",marginBottom:"10px"},input:{fontSize:"16px",marginBottom:"20px",height:"34px"},button:{text:"Log In",fontSize:"16px",color:"#fff",fontWeight:"600",backgroundColor:"#00a19b",marginTop:"25px",padding:"6px 20px",boxShadow:"1px 1px 5px rgba(0, 0, 0, 0.5)",lineHeight:"1.42857"},width:"400px",padding:"20px"},RBTokens.config=function(a){if(void 0!==a.env&&(RBTokens.settings.env=a.env),void 0!==a.libraryId&&void 0!==a.token&&void 0!==a.region)RBTokens.settings.libraryId=a.libraryId,RBTokens.settings.token=a.token,RBTokens.settings.region=a.region;else throw new Error("libraryId, basic token or region is not defined");if(void 0!==a.template&&null!==a.template){var b=document.getElementById(a.template.id);if(null==b)throw new Error("Element is not found");else{b.style.padding=RBTokens.settings.template.padding,b.style.width=a.template.width?a.template.width:RBTokens.settings.template.width;var c=document.createElement("div");c.style.fontSize=a.template.title&&a.template.title.fontSize?a.template.title.fontSize:RBTokens.settings.template.title.fontSize,c.style.color=a.template.title&&a.template.title.color?a.template.title.color:RBTokens.settings.template.title.color,c.style.fontWeight=a.template.title&&a.template.title.fontWeight?a.template.title.fontWeight:RBTokens.settings.template.title.fontWeight,c.innerHTML=a.template.title&&a.template.title.text?a.template.title.text:RBTokens.settings.template.title.text,c.style.marginBottom=RBTokens.settings.template.title.marginBottom,b.appendChild(c);var d=document.createElement("form"),e=document.createElement("label");e.for="librarycard",e.style.display="block",e.style.marginBottom=RBTokens.settings.template.labels.marginBottom,e.style.fontSize=a.template.labels&&a.template.labels.fontSize?a.template.labels.fontSize:RBTokens.settings.template.labels.fontSize,e.style.color=a.template.labels&&a.template.labels.color?a.template.labels.color:RBTokens.settings.template.labels.color,e.style.fontWeight=a.template.labels&&a.template.labels.fontWeight?a.template.labels.fontWeight:RBTokens.settings.template.labels.fontWeight,e.innerHTML=a.template.labels&&a.template.labels.indentifier?a.template.labels.indentifier:RBTokens.settings.template.labels.indentifier,d.appendChild(e);var f=document.createElement("input");f.type="text",f.id="librarycard",f.style.display="block",f.style.marginBottom=RBTokens.settings.template.input.marginBottom,f.style.fontSize=RBTokens.settings.template.input.fontSize,f.style.height=RBTokens.settings.template.input.height,f.style.width="100%",d.appendChild(f),e=document.createElement("label"),e.for="pin",e.style.display="block",e.style.marginBottom=RBTokens.settings.template.labels.marginBottom,e.style.fontSize=a.template.labels&&a.template.labels.fontSize?a.template.labels.fontSize:RBTokens.settings.template.labels.fontSize,e.style.color=a.template.labels&&a.template.labels.color?a.template.labels.color:RBTokens.settings.template.labels.color,e.style.fontWeight=a.template.labels&&a.template.labels.fontWeight?a.template.labels.fontWeight:RBTokens.settings.template.labels.fontWeight,e.innerHTML=a.template.labels&&a.template.labels.secret?a.template.labels.secret:RBTokens.settings.template.labels.secret,d.appendChild(e),f=document.createElement("input"),f.type="password",f.id="pin",f.style.display="block",f.style.fontSize=RBTokens.settings.template.input.fontSize,f.style.height=RBTokens.settings.template.input.height,f.style.width="100%",d.appendChild(f);var g=document.createElement("input");g.type="button",g.style.marginTop=RBTokens.settings.template.button.marginTop,g.style.padding=RBTokens.settings.template.button.padding,g.style.boxShadow=RBTokens.settings.template.button.boxShadow,g.style.lineHeight=RBTokens.settings.template.button.lineHeight,g.style.textAlign="center",g.style.verticalAlign="middle",g.style.cursor="pointer",g.style.fontSize=a.template.button&&a.template.button.fontSize?a.template.button.fontSize:RBTokens.settings.template.button.fontSize,g.style.color=a.template.button&&a.template.button.color?a.template.button.color:RBTokens.settings.template.button.color,g.style.fontWeight=a.template.button&&a.template.button.fontWeight?a.template.button.fontWeight:RBTokens.settings.template.button.fontWeight,g.style.backgroundColor=a.template.button&&a.template.button.backgroundColor?a.template.button.backgroundColor:RBTokens.settings.template.button.backgroundColor,g.value=a.template.button&&a.template.button.text?a.template.button.text:RBTokens.settings.template.button.text,g.onclick=function(h){a.template.button&&a.template.button.click&&"function"==typeof a.template.button.click&&a.template.button.click(h,document.getElementById("librarycard").value,document.getElementById("pin").value)},d.appendChild(g),b.appendChild(d)}}},RBTokens._api=function(a,b,c){if(!RBTokens._check())throw new Error("libraryId, basic token or region is not defined");return new Promise(function(d,e){var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open(a,b),console.log(b,b.includes("library-patron-profile")),b.includes("library-patron-profile")?f.setRequestHeader("Authorization","basic "+RBTokens.settings.token):f.setRequestHeader("Authorization","basic "+RBTokens.settings.token),f.setRequestHeader("Content-type","application/json;charset=UTF-8"),f.onload=function(){200<=this.status&&300>this.status?d(JSON.parse(f.response)):e({message:JSON.parse(f.response).message})},f.onerror=function(){e({message:JSON.parse(f.response).message})},c===void 0?f.send():f.send(c)})},RBTokens._check=function(){return RBTokens.settings.libraryId!==void 0&&RBTokens.settings.token!==void 0&&RBTokens.settings.region},RBTokens.authenticate=function(a){if(a!==void 0&&null!=a&&a.tenantId!==void 0&&a.patronId!==void 0)return RBTokens._api("POST","https://"+RBTokens.constant.authurl+"."+RBTokens.constant[""+RBTokens.settings.env+RBTokens.settings.region]+"/v1/tenants/"+RBTokens.settings.libraryId+"/tokens",JSON.stringify(a));throw new Error("Invalid TenantId or PatronId")},RBTokens._login=function(a,b){return new Promise(function(c,d){RBTokens.account(a).then(function(e){if(Array.isArray(e)){for(var f=!1,g=0;g<e.length;g++)if(e[g].libraryId==RBTokens.settings.libraryId){RBTokens.authenticate({tenantId:RBTokens.settings.libraryId,patronId:e[g].patronId}).then(function(h){c(h),b&&(window.location.href="https://"+h.libraries[0].subdomain+"."+RBTokens.constant[""+RBTokens.settings.env+RBTokens.settings.region]+"/?bearer="+h.bearer)}).catch(function(h){d(h)}),f=!0;break}f||reslove({})}else reslove({})}).catch(function(e){d(e)})})},RBTokens.account=function(a){var b=a&&a.username?"username":a&&a.email?"email":a&&a.librarycard?"librarycard":"",c=a?a[b]:"";if(!b||!c)throw new Error("Invalid parameters supplied");return RBTokens._api("GET","https://"+RBTokens.constant.apiurl+"."+RBTokens.constant[""+RBTokens.settings.env+RBTokens.settings.region]+"/v1/rpc/library-patron-profile?"+b+"="+c)},RBTokens.loginAndRedirect=function(a){return RBTokens._login(a,!0)},RBTokens.login=function(a){return RBTokens._login(a)},RBTokens._register=function(a,b){return new Promise(function(c,d){RBTokens._api("POST","https://"+RBTokens.constant.apiurl+"."+RBTokens.constant[""+RBTokens.settings.env+RBTokens.settings.region]+"/v1/libraries/"+RBTokens.settings.libraryId+"/patrons",JSON.stringify(a)).then(function(e){c(e),b&&(window.location.href="https://"+e.libraries[0].subdomain+"."+RBTokens.constant[""+RBTokens.settings.env+RBTokens.settings.region]+"/?bearer="+e.bearer)}).catch(function(e){d(e)})})},RBTokens.register=function(a){return RBTokens._register(a)},RBTokens.registerAndRedirect=function(a){return RBTokens._register(a,!0)};